/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ApplicationRef } from '@angular/core';
import { InitialState, NgxsBootstrapper } from '@ngxs/store/internals';
import { HmrStateContextFactory } from './internal/hmr-state-context-factory';
import { HmrOptionBuilder } from './internal/hmr-options-builder';
import { HmrInitAction } from './actions/hmr-init.action';
import { HmrLifecycle } from './internal/hmr-lifecycle';
/**
 * @template T, S
 */
export class HmrManager {
    /**
     * @param {?} options
     * @param {?} storage
     */
    constructor(options, storage) {
        this.storage = storage;
        this.optionsBuilder = new HmrOptionBuilder(options);
    }
    /**
     * @private
     * @return {?}
     */
    get applicationRef() {
        return this.ngModule.injector.get(ApplicationRef);
    }
    /**
     * @private
     * @return {?}
     */
    get bootstrap() {
        return this.ngModule.injector.get(NgxsBootstrapper);
    }
    /**
     * @param {?} bootstrapFn
     * @param {?} tick
     * @return {?}
     */
    hmrModule(bootstrapFn, tick) {
        return tslib_1.__awaiter(this, void 0, void 0, function* () {
            InitialState.set(this.storage.snapshot);
            this.ngModule = yield bootstrapFn();
            this.context = new HmrStateContextFactory(this.ngModule);
            this.lifecycle = this.createLifecycle();
            tick();
            InitialState.pop();
            return this.ngModule;
        });
    }
    /**
     * @return {?}
     */
    beforeModuleBootstrap() {
        this.lifecycle.hmrNgxsStoreOnInit((/**
         * @param {?} ctx
         * @param {?} state
         * @return {?}
         */
        (ctx, state) => {
            ctx.dispatch(new HmrInitAction(state));
        }));
    }
    /**
     * @return {?}
     */
    beforeModuleOnDestroy() {
        this.optionsBuilder.clearLogs();
        return this.lifecycle.hmrNgxsStoreBeforeOnDestroy();
    }
    /**
     * @return {?}
     */
    createNewModule() {
        /** @type {?} */
        const removeOldHosts = this.cloneHostsBeforeDestroy();
        this.removeNgStyles();
        this.ngModule.destroy();
        removeOldHosts();
    }
    /**
     * @private
     * @return {?}
     */
    createLifecycle() {
        return new HmrLifecycle(this.ngModule.instance, this.bootstrap, this.storage, this.context, this.optionsBuilder);
    }
    /**
     * @private
     * @return {?}
     */
    cloneHostsBeforeDestroy() {
        /** @type {?} */
        const elements = this.applicationRef.components.map((/**
         * @param {?} component
         * @return {?}
         */
        (component) => component.location.nativeElement));
        /** @type {?} */
        const removableList = elements.map((/**
         * @param {?} componentNode
         * @return {?}
         */
        (componentNode) => {
            /** @type {?} */
            const newNode = document.createElement(componentNode.tagName);
            /** @type {?} */
            const parentNode = (/** @type {?} */ (componentNode.parentNode));
            /** @type {?} */
            const currentDisplay = newNode.style.display;
            newNode.style.display = 'none';
            parentNode.insertBefore(newNode, componentNode);
            return (/**
             * @return {?}
             */
            () => {
                newNode.style.display = currentDisplay;
                try {
                    parentNode.removeChild(componentNode);
                }
                catch (_a) { }
            });
        }));
        return (/**
         * @return {?}
         */
        function removeOldHosts() {
            removableList.forEach((/**
             * @param {?} removeOldHost
             * @return {?}
             */
            (removeOldHost) => removeOldHost()));
        });
    }
    /**
     * @private
     * @return {?}
     */
    removeNgStyles() {
        /** @type {?} */
        const head = (/** @type {?} */ (document.head));
        /** @type {?} */
        const styles = Array.from((/** @type {?} */ (head)).querySelectorAll('style'));
        styles
            .filter((/**
         * @param {?} style
         * @return {?}
         */
        (style) => style.innerText.includes('_ng')))
            .map((/**
         * @param {?} style
         * @return {?}
         */
        (style) => (/** @type {?} */ (head)).removeChild(style)));
    }
}
if (false) {
    /** @type {?} */
    HmrManager.prototype.storage;
    /** @type {?} */
    HmrManager.prototype.context;
    /** @type {?} */
    HmrManager.prototype.lifecycle;
    /** @type {?} */
    HmrManager.prototype.optionsBuilder;
    /**
     * @type {?}
     * @private
     */
    HmrManager.prototype.ngModule;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG1yLW1hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4cy9obXItcGx1Z2luLyIsInNvdXJjZXMiOlsic3JjL2htci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGNBQWMsRUFBNkIsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBU3ZFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7QUFJeEQsTUFBTSxPQUFPLFVBQVU7Ozs7O0lBT3JCLFlBQVksT0FBdUIsRUFBRSxPQUFzQjtRQUN6RCxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksZ0JBQWdCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDdEQsQ0FBQzs7Ozs7SUFFRCxJQUFZLGNBQWM7UUFDeEIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDcEQsQ0FBQzs7Ozs7SUFFRCxJQUFZLFNBQVM7UUFDbkIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUN0RCxDQUFDOzs7Ozs7SUFFWSxTQUFTLENBQ3BCLFdBQWlDLEVBQ2pDLElBQWdCOztZQUVoQixZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxNQUFNLFdBQVcs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QUFRLENBQUMsS0FBSyxDQUFDLEVBQUM7YUFDcEUsR0FBRzs7OztRQUFDLENBQUMsS0FBdUIsRUFBRSxFQUFFLENBQUMsbUJBQUEsSUFBSSxFQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUM7SUFDaEUsQ0FBQztDQUNGOzs7SUFoR0MsNkJBQThCOztJQUM5Qiw2QkFBNkM7O0lBQzdDLCtCQUFxQzs7SUFDckMsb0NBQXdDOzs7OztJQUN4Qyw4QkFBaUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBsaWNhdGlvblJlZiwgQ29tcG9uZW50UmVmLCBOZ01vZHVsZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBJbml0aWFsU3RhdGUsIE5neHNCb290c3RyYXBwZXIgfSBmcm9tICdAbmd4cy9zdG9yZS9pbnRlcm5hbHMnO1xyXG5cclxuaW1wb3J0IHsgSG1yU3RvcmFnZSB9IGZyb20gJy4vaW50ZXJuYWwvaG1yLXN0b3JhZ2UnO1xyXG5pbXBvcnQge1xyXG4gIEJvb3RzdHJhcE1vZHVsZUZuLFxyXG4gIE5neHNIbXJMaWZlQ3ljbGUsXHJcbiAgTmd4c0htck9wdGlvbnMsXHJcbiAgTmd4c0htclNuYXBzaG90XHJcbn0gZnJvbSAnLi9zeW1ib2xzJztcclxuaW1wb3J0IHsgSG1yU3RhdGVDb250ZXh0RmFjdG9yeSB9IGZyb20gJy4vaW50ZXJuYWwvaG1yLXN0YXRlLWNvbnRleHQtZmFjdG9yeSc7XHJcbmltcG9ydCB7IEhtck9wdGlvbkJ1aWxkZXIgfSBmcm9tICcuL2ludGVybmFsL2htci1vcHRpb25zLWJ1aWxkZXInO1xyXG5pbXBvcnQgeyBIbXJJbml0QWN0aW9uIH0gZnJvbSAnLi9hY3Rpb25zL2htci1pbml0LmFjdGlvbic7XHJcbmltcG9ydCB7IEhtckxpZmVjeWNsZSB9IGZyb20gJy4vaW50ZXJuYWwvaG1yLWxpZmVjeWNsZSc7XHJcblxyXG50eXBlIE9sZEhvc3RSZW1vdmVyRm4gPSAoKSA9PiB2b2lkO1xyXG5cclxuZXhwb3J0IGNsYXNzIEhtck1hbmFnZXI8VCBleHRlbmRzIFBhcnRpYWw8Tmd4c0htckxpZmVDeWNsZTxTPj4sIFMgPSBOZ3hzSG1yU25hcHNob3Q+IHtcclxuICBwdWJsaWMgc3RvcmFnZTogSG1yU3RvcmFnZTxTPjtcclxuICBwdWJsaWMgY29udGV4dDogSG1yU3RhdGVDb250ZXh0RmFjdG9yeTxULCBTPjtcclxuICBwdWJsaWMgbGlmZWN5Y2xlOiBIbXJMaWZlY3ljbGU8VCwgUz47XHJcbiAgcHVibGljIG9wdGlvbnNCdWlsZGVyOiBIbXJPcHRpb25CdWlsZGVyO1xyXG4gIHByaXZhdGUgbmdNb2R1bGU6IE5nTW9kdWxlUmVmPFQ+O1xyXG5cclxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBOZ3hzSG1yT3B0aW9ucywgc3RvcmFnZTogSG1yU3RvcmFnZTxTPikge1xyXG4gICAgdGhpcy5zdG9yYWdlID0gc3RvcmFnZTtcclxuICAgIHRoaXMub3B0aW9uc0J1aWxkZXIgPSBuZXcgSG1yT3B0aW9uQnVpbGRlcihvcHRpb25zKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0IGFwcGxpY2F0aW9uUmVmKCk6IEFwcGxpY2F0aW9uUmVmIHtcclxuICAgIHJldHVybiB0aGlzLm5nTW9kdWxlLmluamVjdG9yLmdldChBcHBsaWNhdGlvblJlZik7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGdldCBib290c3RyYXAoKTogTmd4c0Jvb3RzdHJhcHBlciB7XHJcbiAgICByZXR1cm4gdGhpcy5uZ01vZHVsZS5pbmplY3Rvci5nZXQoTmd4c0Jvb3RzdHJhcHBlcik7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYXN5bmMgaG1yTW9kdWxlKFxyXG4gICAgYm9vdHN0cmFwRm46IEJvb3RzdHJhcE1vZHVsZUZuPFQ+LFxyXG4gICAgdGljazogKCkgPT4gdm9pZFxyXG4gICk6IFByb21pc2U8TmdNb2R1bGVSZWY8VD4+IHtcclxuICAgIEluaXRpYWxTdGF0ZS5zZXQodGhpcy5zdG9yYWdlLnNuYXBzaG90KTtcclxuICAgIHRoaXMubmdNb2R1bGUgPSBhd2FpdCBib290c3RyYXBGbigpO1xyXG4gICAgdGhpcy5jb250ZXh0ID0gbmV3IEhtclN0YXRlQ29udGV4dEZhY3RvcnkodGhpcy5uZ01vZHVsZSk7XHJcbiAgICB0aGlzLmxpZmVjeWNsZSA9IHRoaXMuY3JlYXRlTGlmZWN5Y2xlKCk7XHJcblxyXG4gICAgdGljaygpO1xyXG5cclxuICAgIEluaXRpYWxTdGF0ZS5wb3AoKTtcclxuICAgIHJldHVybiB0aGlzLm5nTW9kdWxlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGJlZm9yZU1vZHVsZUJvb3RzdHJhcCgpOiB2b2lkIHtcclxuICAgIHRoaXMubGlmZWN5Y2xlLmhtck5neHNTdG9yZU9uSW5pdCgoY3R4LCBzdGF0ZSkgPT4ge1xyXG4gICAgICBjdHguZGlzcGF0Y2gobmV3IEhtckluaXRBY3Rpb24oc3RhdGUpKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGJlZm9yZU1vZHVsZU9uRGVzdHJveSgpOiBQYXJ0aWFsPFM+IHtcclxuICAgIHRoaXMub3B0aW9uc0J1aWxkZXIuY2xlYXJMb2dzKCk7XHJcbiAgICByZXR1cm4gdGhpcy5saWZlY3ljbGUuaG1yTmd4c1N0b3JlQmVmb3JlT25EZXN0cm95KCk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgY3JlYXRlTmV3TW9kdWxlKCk6IHZvaWQge1xyXG4gICAgY29uc3QgcmVtb3ZlT2xkSG9zdHM6ICgpID0+IHZvaWQgPSB0aGlzLmNsb25lSG9zdHNCZWZvcmVEZXN0cm95KCk7XHJcbiAgICB0aGlzLnJlbW92ZU5nU3R5bGVzKCk7XHJcbiAgICB0aGlzLm5nTW9kdWxlLmRlc3Ryb3koKTtcclxuICAgIHJlbW92ZU9sZEhvc3RzKCk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNyZWF0ZUxpZmVjeWNsZSgpOiBIbXJMaWZlY3ljbGU8VCwgUz4ge1xyXG4gICAgcmV0dXJuIG5ldyBIbXJMaWZlY3ljbGUoXHJcbiAgICAgIHRoaXMubmdNb2R1bGUuaW5zdGFuY2UsXHJcbiAgICAgIHRoaXMuYm9vdHN0cmFwLFxyXG4gICAgICB0aGlzLnN0b3JhZ2UsXHJcbiAgICAgIHRoaXMuY29udGV4dCxcclxuICAgICAgdGhpcy5vcHRpb25zQnVpbGRlclxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY2xvbmVIb3N0c0JlZm9yZURlc3Ryb3koKTogKCkgPT4gdm9pZCB7XHJcbiAgICBjb25zdCBlbGVtZW50czogRWxlbWVudFtdID0gdGhpcy5hcHBsaWNhdGlvblJlZi5jb21wb25lbnRzLm1hcChcclxuICAgICAgKGNvbXBvbmVudDogQ29tcG9uZW50UmVmPEVsZW1lbnQ+KSA9PiBjb21wb25lbnQubG9jYXRpb24ubmF0aXZlRWxlbWVudFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCByZW1vdmFibGVMaXN0OiBPbGRIb3N0UmVtb3ZlckZuW10gPSBlbGVtZW50cy5tYXAoKGNvbXBvbmVudE5vZGU6IEVsZW1lbnQpID0+IHtcclxuICAgICAgY29uc3QgbmV3Tm9kZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50Tm9kZS50YWdOYW1lKTtcclxuICAgICAgY29uc3QgcGFyZW50Tm9kZTogTm9kZSA9IGNvbXBvbmVudE5vZGUucGFyZW50Tm9kZSBhcyBOb2RlO1xyXG4gICAgICBjb25zdCBjdXJyZW50RGlzcGxheTogc3RyaW5nIHwgbnVsbCA9IG5ld05vZGUuc3R5bGUuZGlzcGxheTtcclxuXHJcbiAgICAgIG5ld05vZGUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgcGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobmV3Tm9kZSwgY29tcG9uZW50Tm9kZSk7XHJcblxyXG4gICAgICByZXR1cm4gKCk6IHZvaWQgPT4ge1xyXG4gICAgICAgIG5ld05vZGUuc3R5bGUuZGlzcGxheSA9IGN1cnJlbnREaXNwbGF5O1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBwYXJlbnROb2RlLnJlbW92ZUNoaWxkKGNvbXBvbmVudE5vZGUpO1xyXG4gICAgICAgIH0gY2F0Y2gge31cclxuICAgICAgfTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBmdW5jdGlvbiByZW1vdmVPbGRIb3N0cygpOiB2b2lkIHtcclxuICAgICAgcmVtb3ZhYmxlTGlzdC5mb3JFYWNoKChyZW1vdmVPbGRIb3N0OiBPbGRIb3N0UmVtb3ZlckZuKSA9PiByZW1vdmVPbGRIb3N0KCkpO1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgcmVtb3ZlTmdTdHlsZXMoKTogdm9pZCB7XHJcbiAgICBjb25zdCBoZWFkOiBIVE1MSGVhZEVsZW1lbnQgPSBkb2N1bWVudC5oZWFkITtcclxuICAgIGNvbnN0IHN0eWxlczogSFRNTFN0eWxlRWxlbWVudFtdID0gQXJyYXkuZnJvbShoZWFkIS5xdWVyeVNlbGVjdG9yQWxsKCdzdHlsZScpKTtcclxuXHJcbiAgICBzdHlsZXNcclxuICAgICAgLmZpbHRlcigoc3R5bGU6IEhUTUxTdHlsZUVsZW1lbnQpID0+IHN0eWxlLmlubmVyVGV4dC5pbmNsdWRlcygnX25nJykpXHJcbiAgICAgIC5tYXAoKHN0eWxlOiBIVE1MU3R5bGVFbGVtZW50KSA9PiBoZWFkIS5yZW1vdmVDaGlsZChzdHlsZSkpO1xyXG4gIH1cclxufVxyXG4iXX0=