!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@ngxs/store/internals"),require("@ngxs/store"),require("@ngxs/store/operators")):"function"==typeof define&&define.amd?define("@ngxs/hmr-plugin",["exports","@angular/core","@ngxs/store/internals","@ngxs/store","@ngxs/store/operators"],e):e(((t=t||self).ngxs=t.ngxs||{},t.ngxs["hmr-plugin"]={}),t.ng.core,t["ngxs-store-internals"],t["ngxs-store"],t["ngxs-store-operators"])}(this,(function(t,e,n,o,r){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var i=function(){return(i=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function s(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function u(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(s,u)}a((o=o.apply(t,e||[])).next())}))}function u(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}var a=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"@@HMR_INIT"},enumerable:!0,configurable:!0}),t}();var c=function(){function t(t){this.payload=t}return Object.defineProperty(t,"type",{get:function(){return"@@HMR_BEFORE_DESTROY"},enumerable:!0,configurable:!0}),t}();var l=function(){function t(t){var e=t.injector.get(o.Store,void 0);if(!e)throw new Error("Store not found, maybe you forgot to import the NgxsModule");this.store=e}return t.prototype.createStateContext=function(){var t=this;return{dispatch:function(e){return t.store.dispatch(e)},getState:function(){return t.store.snapshot()},setState:function(e){r.isStateOperator(e)&&(e=e(t.store.snapshot()));return t.store.reset(e),e},patchState:function(e){var n=t.store.snapshot(),o=i({},n,e);return t.store.reset(o),o}}},t}();var f=function(){function t(t){var e=t.deferTime,n=t.autoClearLogs;this.deferTime=e||100,this.autoClearLogs=void 0===n||n}return t.prototype.clearLogs=function(){this.autoClearLogs&&console.clear()},t}();var p=function(){function t(t,e,n,o,r){this.ngAppModule=t,this.bootstrap=e,this.storage=n,this.context=o,this.options=r}return t.prototype.hmrNgxsStoreOnInit=function(t){var e=this.getModuleHmrInitCallback();e=e.bind(this.ngAppModule),this.stateEventLoop((function(n,o){e(n,o),t(n,o)}))},t.prototype.getModuleHmrInitCallback=function(){return"function"==typeof this.ngAppModule.hmrNgxsStoreOnInit?this.ngAppModule.hmrNgxsStoreOnInit:function(t,e){t.patchState(e)}},t.prototype.hmrNgxsStoreBeforeOnDestroy=function(){var t={},e=this.context.createStateContext();return t="function"==typeof this.ngAppModule.hmrNgxsStoreBeforeOnDestroy?this.ngAppModule.hmrNgxsStoreBeforeOnDestroy(e):e.getState(),e.dispatch(new c(t)),t},t.prototype.stateEventLoop=function(t){var e=this;if(this.storage.hasData()){var n=this.bootstrap.appBootstrapped$,o=this.context.store.select((function(t){return t}));n.subscribe((function(){var n,r=o.subscribe((function(){clearInterval(n),n=window.setTimeout((function(){r.unsubscribe(),t(e.context.createStateContext(),e.storage.snapshot)}),e.options.deferTime)}))}))}},t}();var h=function(){function t(t,e){this.storage=e,this.optionsBuilder=new f(t)}return Object.defineProperty(t.prototype,"applicationRef",{get:function(){return this.ngModule.injector.get(e.ApplicationRef)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bootstrap",{get:function(){return this.ngModule.injector.get(n.NgxsBootstrapper)},enumerable:!0,configurable:!0}),t.prototype.hmrModule=function(t,e){return s(this,void 0,void 0,(function(){var o;return u(this,(function(r){switch(r.label){case 0:return n.InitialState.set(this.storage.snapshot),o=this,[4,t()];case 1:return o.ngModule=r.sent(),this.context=new l(this.ngModule),this.lifecycle=this.createLifecycle(),e(),n.InitialState.pop(),[2,this.ngModule]}}))}))},t.prototype.beforeModuleBootstrap=function(){this.lifecycle.hmrNgxsStoreOnInit((function(t,e){t.dispatch(new a(e))}))},t.prototype.beforeModuleOnDestroy=function(){return this.optionsBuilder.clearLogs(),this.lifecycle.hmrNgxsStoreBeforeOnDestroy()},t.prototype.createNewModule=function(){var t=this.cloneHostsBeforeDestroy();this.removeNgStyles(),this.ngModule.destroy(),t()},t.prototype.createLifecycle=function(){return new p(this.ngModule.instance,this.bootstrap,this.storage,this.context,this.optionsBuilder)},t.prototype.cloneHostsBeforeDestroy=function(){var t=this.applicationRef.components.map((function(t){return t.location.nativeElement})).map((function(t){var e=document.createElement(t.tagName),n=t.parentNode,o=e.style.display;return e.style.display="none",n.insertBefore(e,t),function(){e.style.display=o;try{n.removeChild(t)}catch(t){}}}));return function(){t.forEach((function(t){return t()}))}},t.prototype.removeNgStyles=function(){var t=document.head;Array.from(t.querySelectorAll("style")).filter((function(t){return t.innerText.includes("_ng")})).map((function(e){return t.removeChild(e)}))},t}();var d=function(){function t(t){void 0===t&&(t={}),this._snapshot=t}return t.prototype.hasData=function(){return Object.keys(this._snapshot).length>0},Object.defineProperty(t.prototype,"snapshot",{get:function(){return this._snapshot},enumerable:!0,configurable:!0}),t}();t.HmrBeforeDestroyAction=c,t.HmrInitAction=a,t.hmr=function(t,e,n){return void 0===n&&(n={}),s(this,void 0,void 0,(function(){var o,r,i;return u(this,(function(s){switch(s.label){case 0:if(!t.hot)throw console.error("Are you using the --hmr flag for ng serve?"),new Error("HMR is not enabled for webpack-dev-server!");return window.NGXS_HMR_LIFECYCLE_STATUS=window.NGXS_HMR_LIFECYCLE_STATUS||{hmrReloaded:!1},t.hot.accept(),o=t.hot.data||{},r=new d(o.snapshot||{}),[4,(i=new h(n,r)).hmrModule(e,(function(){i.beforeModuleBootstrap(),t.hot.dispose((function(t){var e;e=!0,window.NGXS_HMR_LIFECYCLE_STATUS&&(window.NGXS_HMR_LIFECYCLE_STATUS.hmrReloaded=e),t.snapshot=i.beforeModuleOnDestroy(),i.createNewModule()}))}))];case 1:return[2,s.sent()]}}))}))},t.hmrIsReloaded=function(){return!(!window.NGXS_HMR_LIFECYCLE_STATUS||!window.NGXS_HMR_LIFECYCLE_STATUS.hmrReloaded)},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=ngxs-hmr-plugin.umd.min.js.map