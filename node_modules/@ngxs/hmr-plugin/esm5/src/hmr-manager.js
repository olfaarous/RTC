/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { ApplicationRef } from '@angular/core';
import { InitialState, NgxsBootstrapper } from '@ngxs/store/internals';
import { HmrStateContextFactory } from './internal/hmr-state-context-factory';
import { HmrOptionBuilder } from './internal/hmr-options-builder';
import { HmrInitAction } from './actions/hmr-init.action';
import { HmrLifecycle } from './internal/hmr-lifecycle';
/**
 * @template T, S
 */
var /**
 * @template T, S
 */
HmrManager = /** @class */ (function () {
    function HmrManager(options, storage) {
        this.storage = storage;
        this.optionsBuilder = new HmrOptionBuilder(options);
    }
    Object.defineProperty(HmrManager.prototype, "applicationRef", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.ngModule.injector.get(ApplicationRef);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(HmrManager.prototype, "bootstrap", {
        get: /**
         * @private
         * @return {?}
         */
        function () {
            return this.ngModule.injector.get(NgxsBootstrapper);
        },
        enumerable: true,
        configurable: true
    });
    /**
     * @param {?} bootstrapFn
     * @param {?} tick
     * @return {?}
     */
    HmrManager.prototype.hmrModule = /**
     * @param {?} bootstrapFn
     * @param {?} tick
     * @return {?}
     */
    function (bootstrapFn, tick) {
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            var _a;
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        InitialState.set(this.storage.snapshot);
                        _a = this;
                        return [4 /*yield*/, bootstrapFn()];
                    case 1:
                        _a.ngModule = _b.sent();
                        this.context = new HmrStateContextFactory(this.ngModule);
                        this.lifecycle = this.createLifecycle();
                        tick();
                        InitialState.pop();
                        return [2 /*return*/, this.ngModule];
                }
            });
        });
    };
    /**
     * @return {?}
     */
    HmrManager.prototype.beforeModuleBootstrap = /**
     * @return {?}
     */
    function () {
        this.lifecycle.hmrNgxsStoreOnInit((/**
         * @param {?} ctx
         * @param {?} state
         * @return {?}
         */
        function (ctx, state) {
            ctx.dispatch(new HmrInitAction(state));
        }));
    };
    /**
     * @return {?}
     */
    HmrManager.prototype.beforeModuleOnDestroy = /**
     * @return {?}
     */
    function () {
        this.optionsBuilder.clearLogs();
        return this.lifecycle.hmrNgxsStoreBeforeOnDestroy();
    };
    /**
     * @return {?}
     */
    HmrManager.prototype.createNewModule = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var removeOldHosts = this.cloneHostsBeforeDestroy();
        this.removeNgStyles();
        this.ngModule.destroy();
        removeOldHosts();
    };
    /**
     * @private
     * @return {?}
     */
    HmrManager.prototype.createLifecycle = /**
     * @private
     * @return {?}
     */
    function () {
        return new HmrLifecycle(this.ngModule.instance, this.bootstrap, this.storage, this.context, this.optionsBuilder);
    };
    /**
     * @private
     * @return {?}
     */
    HmrManager.prototype.cloneHostsBeforeDestroy = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var elements = this.applicationRef.components.map((/**
         * @param {?} component
         * @return {?}
         */
        function (component) { return component.location.nativeElement; }));
        /** @type {?} */
        var removableList = elements.map((/**
         * @param {?} componentNode
         * @return {?}
         */
        function (componentNode) {
            /** @type {?} */
            var newNode = document.createElement(componentNode.tagName);
            /** @type {?} */
            var parentNode = (/** @type {?} */ (componentNode.parentNode));
            /** @type {?} */
            var currentDisplay = newNode.style.display;
            newNode.style.display = 'none';
            parentNode.insertBefore(newNode, componentNode);
            return (/**
             * @return {?}
             */
            function () {
                newNode.style.display = currentDisplay;
                try {
                    parentNode.removeChild(componentNode);
                }
                catch (_a) { }
            });
        }));
        return (/**
         * @return {?}
         */
        function removeOldHosts() {
            removableList.forEach((/**
             * @param {?} removeOldHost
             * @return {?}
             */
            function (removeOldHost) { return removeOldHost(); }));
        });
    };
    /**
     * @private
     * @return {?}
     */
    HmrManager.prototype.removeNgStyles = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var head = (/** @type {?} */ (document.head));
        /** @type {?} */
        var styles = Array.from((/** @type {?} */ (head)).querySelectorAll('style'));
        styles
            .filter((/**
         * @param {?} style
         * @return {?}
         */
        function (style) { return style.innerText.includes('_ng'); }))
            .map((/**
         * @param {?} style
         * @return {?}
         */
        function (style) { return (/** @type {?} */ (head)).removeChild(style); }));
    };
    return HmrManager;
}());
/**
 * @template T, S
 */
export { HmrManager };
if (false) {
    /** @type {?} */
    HmrManager.prototype.storage;
    /** @type {?} */
    HmrManager.prototype.context;
    /** @type {?} */
    HmrManager.prototype.lifecycle;
    /** @type {?} */
    HmrManager.prototype.optionsBuilder;
    /**
     * @type {?}
     * @private
     */
    HmrManager.prototype.ngModule;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaG1yLW1hbmFnZXIuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9Abmd4cy9obXItcGx1Z2luLyIsInNvdXJjZXMiOlsic3JjL2htci1tYW5hZ2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsT0FBTyxFQUFFLGNBQWMsRUFBNkIsTUFBTSxlQUFlLENBQUM7QUFDMUUsT0FBTyxFQUFFLFlBQVksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBU3ZFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUMxRCxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7Ozs7QUFJeEQ7Ozs7SUFPRSxvQkFBWSxPQUF1QixFQUFFLE9BQXNCO1FBQ3pELElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsc0JBQVksc0NBQWM7Ozs7O1FBQTFCO1lBQ0UsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDcEQsQ0FBQzs7O09BQUE7SUFFRCxzQkFBWSxpQ0FBUzs7Ozs7UUFBckI7WUFDRSxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3RELENBQUM7OztPQUFBOzs7Ozs7SUFFWSw4QkFBUzs7Ozs7SUFBdEIsVUFDRSxXQUFpQyxFQUNqQyxJQUFnQjs7Ozs7O3dCQUVoQixZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7d0JBQ3hDLEtB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QUMsT0FBTyxDQUFDLENBQUM7UUFFOUUsTUFBTTthQUNILE1BQU07Ozs7UUFBQyxVQUFDLEtBQXVCLElBQUssT0FBQSxLQUFLLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBL0IsQ0FBK0IsRUFBQzthQUNwRSxHQUFHOzs7O1FBQUMsVUFBQyxLQUF1QixJQUFLLE9BQUEsbUJBQUEsSUFBSSxFQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxFQUF4QixDQUF3QixFQUFDLENBQUM7SUFDaEUsQ0FBQztJQUNILGlCQUFDO0FBQUQsQ0FBQyxBQWpHRCxJQWlHQzs7Ozs7OztJQWhHQyw2QkFBOEI7O0lBQzlCLDZCQUE2Qzs7SUFDN0MsK0JBQXFDOztJQUNyQyxvQ0FBd0M7Ozs7O0lBQ3hDLDhCQUFpQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcGxpY2F0aW9uUmVmLCBDb21wb25lbnRSZWYsIE5nTW9kdWxlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEluaXRpYWxTdGF0ZSwgTmd4c0Jvb3RzdHJhcHBlciB9IGZyb20gJ0BuZ3hzL3N0b3JlL2ludGVybmFscyc7XHJcblxyXG5pbXBvcnQgeyBIbXJTdG9yYWdlIH0gZnJvbSAnLi9pbnRlcm5hbC9obXItc3RvcmFnZSc7XHJcbmltcG9ydCB7XHJcbiAgQm9vdHN0cmFwTW9kdWxlRm4sXHJcbiAgTmd4c0htckxpZmVDeWNsZSxcclxuICBOZ3hzSG1yT3B0aW9ucyxcclxuICBOZ3hzSG1yU25hcHNob3RcclxufSBmcm9tICcuL3N5bWJvbHMnO1xyXG5pbXBvcnQgeyBIbXJTdGF0ZUNvbnRleHRGYWN0b3J5IH0gZnJvbSAnLi9pbnRlcm5hbC9obXItc3RhdGUtY29udGV4dC1mYWN0b3J5JztcclxuaW1wb3J0IHsgSG1yT3B0aW9uQnVpbGRlciB9IGZyb20gJy4vaW50ZXJuYWwvaG1yLW9wdGlvbnMtYnVpbGRlcic7XHJcbmltcG9ydCB7IEhtckluaXRBY3Rpb24gfSBmcm9tICcuL2FjdGlvbnMvaG1yLWluaXQuYWN0aW9uJztcclxuaW1wb3J0IHsgSG1yTGlmZWN5Y2xlIH0gZnJvbSAnLi9pbnRlcm5hbC9obXItbGlmZWN5Y2xlJztcclxuXHJcbnR5cGUgT2xkSG9zdFJlbW92ZXJGbiA9ICgpID0+IHZvaWQ7XHJcblxyXG5leHBvcnQgY2xhc3MgSG1yTWFuYWdlcjxUIGV4dGVuZHMgUGFydGlhbDxOZ3hzSG1yTGlmZUN5Y2xlPFM+PiwgUyA9IE5neHNIbXJTbmFwc2hvdD4ge1xyXG4gIHB1YmxpYyBzdG9yYWdlOiBIbXJTdG9yYWdlPFM+O1xyXG4gIHB1YmxpYyBjb250ZXh0OiBIbXJTdGF0ZUNvbnRleHRGYWN0b3J5PFQsIFM+O1xyXG4gIHB1YmxpYyBsaWZlY3ljbGU6IEhtckxpZmVjeWNsZTxULCBTPjtcclxuICBwdWJsaWMgb3B0aW9uc0J1aWxkZXI6IEhtck9wdGlvbkJ1aWxkZXI7XHJcbiAgcHJpdmF0ZSBuZ01vZHVsZTogTmdNb2R1bGVSZWY8VD47XHJcblxyXG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IE5neHNIbXJPcHRpb25zLCBzdG9yYWdlOiBIbXJTdG9yYWdlPFM+KSB7XHJcbiAgICB0aGlzLnN0b3JhZ2UgPSBzdG9yYWdlO1xyXG4gICAgdGhpcy5vcHRpb25zQnVpbGRlciA9IG5ldyBIbXJPcHRpb25CdWlsZGVyKG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBnZXQgYXBwbGljYXRpb25SZWYoKTogQXBwbGljYXRpb25SZWYge1xyXG4gICAgcmV0dXJuIHRoaXMubmdNb2R1bGUuaW5qZWN0b3IuZ2V0KEFwcGxpY2F0aW9uUmVmKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgZ2V0IGJvb3RzdHJhcCgpOiBOZ3hzQm9vdHN0cmFwcGVyIHtcclxuICAgIHJldHVybiB0aGlzLm5nTW9kdWxlLmluamVjdG9yLmdldChOZ3hzQm9vdHN0cmFwcGVyKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBhc3luYyBobXJNb2R1bGUoXHJcbiAgICBib290c3RyYXBGbjogQm9vdHN0cmFwTW9kdWxlRm48VD4sXHJcbiAgICB0aWNrOiAoKSA9PiB2b2lkXHJcbiAgKTogUHJvbWlzZTxOZ01vZHVsZVJlZjxUPj4ge1xyXG4gICAgSW5pdGlhbFN0YXRlLnNldCh0aGlzLnN0b3JhZ2Uuc25hcHNob3QpO1xyXG4gICAgdGhpcy5uZ01vZHVsZSA9IGF3YWl0IGJvb3RzdHJhcEZuKCk7XHJcbiAgICB0aGlzLmNvbnRleHQgPSBuZXcgSG1yU3RhdGVDb250ZXh0RmFjdG9yeSh0aGlzLm5nTW9kdWxlKTtcclxuICAgIHRoaXMubGlmZWN5Y2xlID0gdGhpcy5jcmVhdGVMaWZlY3ljbGUoKTtcclxuXHJcbiAgICB0aWNrKCk7XHJcblxyXG4gICAgSW5pdGlhbFN0YXRlLnBvcCgpO1xyXG4gICAgcmV0dXJuIHRoaXMubmdNb2R1bGU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYmVmb3JlTW9kdWxlQm9vdHN0cmFwKCk6IHZvaWQge1xyXG4gICAgdGhpcy5saWZlY3ljbGUuaG1yTmd4c1N0b3JlT25Jbml0KChjdHgsIHN0YXRlKSA9PiB7XHJcbiAgICAgIGN0eC5kaXNwYXRjaChuZXcgSG1ySW5pdEFjdGlvbihzdGF0ZSkpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgYmVmb3JlTW9kdWxlT25EZXN0cm95KCk6IFBhcnRpYWw8Uz4ge1xyXG4gICAgdGhpcy5vcHRpb25zQnVpbGRlci5jbGVhckxvZ3MoKTtcclxuICAgIHJldHVybiB0aGlzLmxpZmVjeWNsZS5obXJOZ3hzU3RvcmVCZWZvcmVPbkRlc3Ryb3koKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBjcmVhdGVOZXdNb2R1bGUoKTogdm9pZCB7XHJcbiAgICBjb25zdCByZW1vdmVPbGRIb3N0czogKCkgPT4gdm9pZCA9IHRoaXMuY2xvbmVIb3N0c0JlZm9yZURlc3Ryb3koKTtcclxuICAgIHRoaXMucmVtb3ZlTmdTdHlsZXMoKTtcclxuICAgIHRoaXMubmdNb2R1bGUuZGVzdHJveSgpO1xyXG4gICAgcmVtb3ZlT2xkSG9zdHMoKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgY3JlYXRlTGlmZWN5Y2xlKCk6IEhtckxpZmVjeWNsZTxULCBTPiB7XHJcbiAgICByZXR1cm4gbmV3IEhtckxpZmVjeWNsZShcclxuICAgICAgdGhpcy5uZ01vZHVsZS5pbnN0YW5jZSxcclxuICAgICAgdGhpcy5ib290c3RyYXAsXHJcbiAgICAgIHRoaXMuc3RvcmFnZSxcclxuICAgICAgdGhpcy5jb250ZXh0LFxyXG4gICAgICB0aGlzLm9wdGlvbnNCdWlsZGVyXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBjbG9uZUhvc3RzQmVmb3JlRGVzdHJveSgpOiAoKSA9PiB2b2lkIHtcclxuICAgIGNvbnN0IGVsZW1lbnRzOiBFbGVtZW50W10gPSB0aGlzLmFwcGxpY2F0aW9uUmVmLmNvbXBvbmVudHMubWFwKFxyXG4gICAgICAoY29tcG9uZW50OiBDb21wb25lbnRSZWY8RWxlbWVudD4pID0+IGNvbXBvbmVudC5sb2NhdGlvbi5uYXRpdmVFbGVtZW50XHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IHJlbW92YWJsZUxpc3Q6IE9sZEhvc3RSZW1vdmVyRm5bXSA9IGVsZW1lbnRzLm1hcCgoY29tcG9uZW50Tm9kZTogRWxlbWVudCkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdOb2RlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjb21wb25lbnROb2RlLnRhZ05hbWUpO1xyXG4gICAgICBjb25zdCBwYXJlbnROb2RlOiBOb2RlID0gY29tcG9uZW50Tm9kZS5wYXJlbnROb2RlIGFzIE5vZGU7XHJcbiAgICAgIGNvbnN0IGN1cnJlbnREaXNwbGF5OiBzdHJpbmcgfCBudWxsID0gbmV3Tm9kZS5zdHlsZS5kaXNwbGF5O1xyXG5cclxuICAgICAgbmV3Tm9kZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICBwYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdOb2RlLCBjb21wb25lbnROb2RlKTtcclxuXHJcbiAgICAgIHJldHVybiAoKTogdm9pZCA9PiB7XHJcbiAgICAgICAgbmV3Tm9kZS5zdHlsZS5kaXNwbGF5ID0gY3VycmVudERpc3BsYXk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIHBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY29tcG9uZW50Tm9kZSk7XHJcbiAgICAgICAgfSBjYXRjaCB7fVxyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIHJlbW92ZU9sZEhvc3RzKCk6IHZvaWQge1xyXG4gICAgICByZW1vdmFibGVMaXN0LmZvckVhY2goKHJlbW92ZU9sZEhvc3Q6IE9sZEhvc3RSZW1vdmVyRm4pID0+IHJlbW92ZU9sZEhvc3QoKSk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSByZW1vdmVOZ1N0eWxlcygpOiB2b2lkIHtcclxuICAgIGNvbnN0IGhlYWQ6IEhUTUxIZWFkRWxlbWVudCA9IGRvY3VtZW50LmhlYWQhO1xyXG4gICAgY29uc3Qgc3R5bGVzOiBIVE1MU3R5bGVFbGVtZW50W10gPSBBcnJheS5mcm9tKGhlYWQhLnF1ZXJ5U2VsZWN0b3JBbGwoJ3N0eWxlJykpO1xyXG5cclxuICAgIHN0eWxlc1xyXG4gICAgICAuZmlsdGVyKChzdHlsZTogSFRNTFN0eWxlRWxlbWVudCkgPT4gc3R5bGUuaW5uZXJUZXh0LmluY2x1ZGVzKCdfbmcnKSlcclxuICAgICAgLm1hcCgoc3R5bGU6IEhUTUxTdHlsZUVsZW1lbnQpID0+IGhlYWQhLnJlbW92ZUNoaWxkKHN0eWxlKSk7XHJcbiAgfVxyXG59XHJcbiJdfQ==