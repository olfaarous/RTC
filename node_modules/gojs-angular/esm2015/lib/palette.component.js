/**
 * @fileoverview added by tsickle
 * Generated from: lib/palette.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, IterableDiffers, KeyValueDiffers, NgZone, Output, ViewChild } from '@angular/core';
import * as go from 'gojs';
export class PaletteComponent {
    /**
     * @param {?} _differs
     * @param {?} _kvdiffers
     * @param {?} zone
     */
    constructor(_differs, _kvdiffers, zone) {
        this._differs = _differs;
        this._kvdiffers = _kvdiffers;
        this.zone = zone;
        // Link data for palette. Optional
        this.linkDataArray = null;
        // Model data for palette. Optional
        this.modelData = null;
        // model changed listener function for palette
        this.modelChangedListener = null;
        // event emitter -- fires when palette model changes. Capture this emitted event in parent component
        this.modelChange = new EventEmitter();
        // The Palette itself
        this.palette = null;
        // differs used to check if there have been changed to the array @Inputs
        // without them, changes to the input arrays won't register in ngOnChanges,
        // since the array reference itself may be the same
        this._ndaDiffer = this._differs.find([]).create(null);
        this._ldaDiffer = this._differs.find([]).create(null);
        // also watch if model data changes; this differ must be initialized in ngOnInit
    } // end constructor
    // end constructor
    /**
     * @return {?}
     */
    ngOnInit() {
        // initialize the differ that listens for changes to modelData object
        if (this.modelData) {
            this._mdDiffer = this._kvdiffers.find(this.modelData).create();
        }
    } // end ngOnInit
    // end ngOnInit
    /**
     * Initialize Palette after view init
     * @return {?}
     */
    ngAfterViewInit() {
        if (!this.paletteDiv)
            return;
        this.palette = this.initPalette();
        // This bit of code makes sure the mousemove event listeners on the canvas are run outside NgZone
        // This makes it so change detection isn't triggered every time the mouse is moved inside the canvas, greatly improving performance
        // If some state-altering behavior must happen on a mousemove event inside the palette,
        // you will have to using zone.run() to make sure that event triggers angular change detection
        this.palette.addEventListener = (/**
         * @param {?} DOMElement
         * @param {?} name
         * @param {?} listener
         * @param {?} capture
         * @return {?}
         */
        (DOMElement, name, listener, capture) => {
            /** @type {?} */
            const superAddEventListener = go.Diagram.prototype.addEventListener;
            if (name === 'mousemove') {
                this.zone.runOutsideAngular((/**
                 * @return {?}
                 */
                () => superAddEventListener.call(this, DOMElement, name, listener, capture)));
            }
            else {
                this.zone.run((/**
                 * @return {?}
                 */
                () => {
                    superAddEventListener.call(this, DOMElement, name, listener, capture);
                }));
            }
        });
        // assign the Palette's div, which (among many other things) will attach a bunch of listeners to the canvas,
        // using the overridden addEventListener function above
        /** @type {?} */
        const divRef = this.paletteDiv.nativeElement;
        this.palette.div = divRef;
        // initialize palette model
        this.palette.delayInitialization((/**
         * @return {?}
         */
        () => {
            /** @type {?} */
            const model = this.palette.model;
            model.commit((/**
             * @param {?} m
             * @return {?}
             */
            (m) => {
                m.mergeNodeDataArray(m.cloneDeep(this.nodeDataArray));
                if (this.linkDataArray && m instanceof go.GraphLinksModel) {
                    m.mergeLinkDataArray(m.cloneDeep(this.linkDataArray));
                }
                if (this.modelData) {
                    m.assignAllDataProperties(m.modelData, this.modelData);
                }
            }), null);
        }));
        // initializer listener
        this.modelChangedListener = (/**
         * @param {?} e
         * @return {?}
         */
        (e) => {
            if (e.isTransactionFinished) {
                // this must be done within a NgZone.run block, so changes are detected in the parent component
                this.zone.run((/**
                 * @return {?}
                 */
                () => {
                    /** @type {?} */
                    const dataChanges = (/** @type {?} */ (e.model)).toIncrementalData(e);
                    this.modelChange.emit(dataChanges);
                }));
            }
        });
        this.palette.addModelChangedListener(this.modelChangedListener);
    } // end ngAfterViewInit
    // end ngAfterViewInit
    /**
     * Always be checking if array Input data has changed (node and link data arrays)
     * @return {?}
     */
    ngDoCheck() {
        /** @type {?} */
        const nodeDataArrayChanges = this._ndaDiffer.diff(this.nodeDataArray);
        /** @type {?} */
        const linkDataArrayChanges = this._ldaDiffer.diff(this.linkDataArray);
        /** @type {?} */
        let modelDataChanges = null;
        if (this._mdDiffer) {
            modelDataChanges = this._mdDiffer.diff(this.modelData);
        }
        if (nodeDataArrayChanges || linkDataArrayChanges || modelDataChanges) {
            this.updateFromAppData();
        }
    } // end ngDoCheck
    // end ngDoCheck
    /**
     * Some input property has changed (or its contents changed) in parent component.
     * Update palette data accordingly
     * @return {?}
     */
    updateFromAppData() {
        if (!this.palette)
            return;
        /** @type {?} */
        const model = this.palette.model;
        model.startTransaction('update data');
        model.mergeNodeDataArray(model.cloneDeep(this.nodeDataArray));
        if (this.linkDataArray && model instanceof go.GraphLinksModel) {
            model.mergeLinkDataArray(model.cloneDeep(this.linkDataArray));
        }
        if (this.modelData) {
            model.assignAllDataProperties(model.modelData, this.modelData);
        }
        model.commitTransaction('update data');
    }
}
PaletteComponent.decorators = [
    { type: Component, args: [{
                selector: 'gojs-palette',
                template: '<div #ngPalette [className]=divClassName></div>'
            }] }
];
/** @nocollapse */
PaletteComponent.ctorParameters = () => [
    { type: IterableDiffers },
    { type: KeyValueDiffers },
    { type: NgZone }
];
PaletteComponent.propDecorators = {
    initPalette: [{ type: Input }],
    nodeDataArray: [{ type: Input }],
    linkDataArray: [{ type: Input }],
    modelData: [{ type: Input }],
    divClassName: [{ type: Input }],
    modelChangedListener: [{ type: Input }],
    modelChange: [{ type: Output }],
    paletteDiv: [{ type: ViewChild, args: ['ngPalette', { static: true },] }]
};
if (false) {
    /**
     * Palette initialization function. Returns a go.Palette.
     * Do not initialize model data in this function.
     * @type {?}
     */
    PaletteComponent.prototype.initPalette;
    /** @type {?} */
    PaletteComponent.prototype.nodeDataArray;
    /** @type {?} */
    PaletteComponent.prototype.linkDataArray;
    /** @type {?} */
    PaletteComponent.prototype.modelData;
    /** @type {?} */
    PaletteComponent.prototype.divClassName;
    /** @type {?} */
    PaletteComponent.prototype.modelChangedListener;
    /** @type {?} */
    PaletteComponent.prototype.modelChange;
    /** @type {?} */
    PaletteComponent.prototype.paletteDiv;
    /** @type {?} */
    PaletteComponent.prototype.palette;
    /** @type {?} */
    PaletteComponent.prototype._ndaDiffer;
    /** @type {?} */
    PaletteComponent.prototype._ldaDiffer;
    /**
     * @type {?}
     * @private
     */
    PaletteComponent.prototype._mdDiffer;
    /**
     * @type {?}
     * @private
     */
    PaletteComponent.prototype._differs;
    /**
     * @type {?}
     * @private
     */
    PaletteComponent.prototype._kvdiffers;
    /** @type {?} */
    PaletteComponent.prototype.zone;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFsZXR0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9nb2pzLWFuZ3VsYXIvIiwic291cmNlcyI6WyJsaWIvcGFsZXR0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLGVBQWUsRUFBa0IsZUFBZSxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ3hKLE9BQU8sS0FBSyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBSzNCLE1BQU0sT0FBTyxnQkFBZ0I7Ozs7OztJQXNDM0IsWUFBb0IsUUFBeUIsRUFBVSxVQUEyQixFQUFTLElBQVk7UUFBbkYsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFBVSxlQUFVLEdBQVYsVUFBVSxDQUFpQjtRQUFTLFNBQUksR0FBSixJQUFJLENBQVE7O1FBMUJ2RixrQkFBYSxHQUF5QixJQUFJLENBQUM7O1FBRzNDLGNBQVMsR0FBa0IsSUFBSSxDQUFDOztRQU1oQyx5QkFBb0IsR0FBd0MsSUFBSSxDQUFDOztRQUdoRSxnQkFBVyxHQUFxQyxJQUFJLFlBQVksRUFBc0IsQ0FBQzs7UUFLakcsWUFBTyxHQUFzQixJQUFJLENBQUM7UUFVdkMsd0VBQXdFO1FBQ3hFLDJFQUEyRTtRQUMzRSxtREFBbUQ7UUFDbkQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFdEQsZ0ZBQWdGO0lBQ2xGLENBQUMsQ0FBQyxrQkFBa0I7Ozs7O0lBRWIsUUFBUTtRQUNiLHFFQUFxRTtRQUNy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QyxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NBQ2hFO1FBQ0QsS0FBSyxDQUFDLGlCQUFpQixDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRXpDLENBQUM7OztZQXBKRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLFFBQVEsRUFBRSxpREFBaUQ7YUFDNUQ7Ozs7WUFMb0QsZUFBZTtZQUFrQixlQUFlO1lBQUUsTUFBTTs7OzBCQVkxRyxLQUFLOzRCQUdMLEtBQUs7NEJBR0wsS0FBSzt3QkFHTCxLQUFLOzJCQUdMLEtBQUs7bUNBR0wsS0FBSzswQkFHTCxNQUFNO3lCQUVOLFNBQVMsU0FBQyxXQUFXLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFOzs7Ozs7OztJQXBCeEMsdUNBQThDOztJQUc5Qyx5Q0FBb0Q7O0lBR3BELHlDQUEyRDs7SUFHM0QscUNBQWdEOztJQUdoRCx3Q0FBcUM7O0lBR3JDLGdEQUFpRjs7SUFHakYsdUNBQXdHOztJQUV4RyxzQ0FBd0U7O0lBR3hFLG1DQUF5Qzs7SUFHekMsc0NBQXVCOztJQUN2QixzQ0FBdUI7Ozs7O0lBR3ZCLHFDQUErQzs7Ozs7SUFFbkMsb0NBQWlDOzs7OztJQUFFLHNDQUFtQzs7SUFBRSxnQ0FBbUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIEVsZW1lbnRSZWYsIEV2ZW50RW1pdHRlciwgSW5wdXQsIEl0ZXJhYmxlRGlmZmVycywgS2V5VmFsdWVEaWZmZXIsIEtleVZhbHVlRGlmZmVycywgTmdab25lLCBPdXRwdXQsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgKiBhcyBnbyBmcm9tICdnb2pzJztcclxuQENvbXBvbmVudCh7XHJcbiAgc2VsZWN0b3I6ICdnb2pzLXBhbGV0dGUnLFxyXG4gIHRlbXBsYXRlOiAnPGRpdiAjbmdQYWxldHRlIFtjbGFzc05hbWVdPWRpdkNsYXNzTmFtZT48L2Rpdj4nXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBQYWxldHRlQ29tcG9uZW50IHtcclxuXHJcbiAgLyoqXHJcbiAgICogUGFsZXR0ZSBpbml0aWFsaXphdGlvbiBmdW5jdGlvbi4gUmV0dXJucyBhIGdvLlBhbGV0dGUuXHJcbiAgICogRG8gbm90IGluaXRpYWxpemUgbW9kZWwgZGF0YSBpbiB0aGlzIGZ1bmN0aW9uLlxyXG4gICAqL1xyXG4gIEBJbnB1dCgpIHB1YmxpYyBpbml0UGFsZXR0ZTogKCkgPT4gZ28uUGFsZXR0ZTtcclxuXHJcbiAgLy8gTm9kZSBkYXRhIGZvciBwYWxldHRlXHJcbiAgQElucHV0KCkgcHVibGljIG5vZGVEYXRhQXJyYXk6IEFycmF5PGdvLk9iamVjdERhdGE+O1xyXG5cclxuICAvLyBMaW5rIGRhdGEgZm9yIHBhbGV0dGUuIE9wdGlvbmFsXHJcbiAgQElucHV0KCkgcHVibGljIGxpbmtEYXRhQXJyYXk6IEFycmF5PGdvLk9iamVjdERhdGE+ID0gbnVsbDtcclxuXHJcbiAgLy8gTW9kZWwgZGF0YSBmb3IgcGFsZXR0ZS4gT3B0aW9uYWxcclxuICBASW5wdXQoKSBwdWJsaWMgbW9kZWxEYXRhOiBnby5PYmplY3REYXRhID0gbnVsbDtcclxuXHJcbiAgLy8gUGFsZXR0ZSBkaXYgY2xhc3MgbmFtZS4gVXNlIHRoaXMgbmFtZSB0byBzdHlsZSB5b3VyIHBhbGV0dGUgaW4gQ1NTXHJcbiAgQElucHV0KCkgcHVibGljIGRpdkNsYXNzTmFtZTogc3RyaW5nO1xyXG5cclxuICAvLyBtb2RlbCBjaGFuZ2VkIGxpc3RlbmVyIGZ1bmN0aW9uIGZvciBwYWxldHRlXHJcbiAgQElucHV0KCkgcHVibGljIG1vZGVsQ2hhbmdlZExpc3RlbmVyOiAoZTogZ28uQ2hhbmdlZEV2ZW50KSA9PiB2b2lkIHwgbnVsbCA9IG51bGw7XHJcblxyXG4gIC8vIGV2ZW50IGVtaXR0ZXIgLS0gZmlyZXMgd2hlbiBwYWxldHRlIG1vZGVsIGNoYW5nZXMuIENhcHR1cmUgdGhpcyBlbWl0dGVkIGV2ZW50IGluIHBhcmVudCBjb21wb25lbnRcclxuICBAT3V0cHV0KCkgcHVibGljIG1vZGVsQ2hhbmdlOiBFdmVudEVtaXR0ZXI8Z28uSW5jcmVtZW50YWxEYXRhPiA9IG5ldyBFdmVudEVtaXR0ZXI8Z28uSW5jcmVtZW50YWxEYXRhPigpO1xyXG5cclxuICBAVmlld0NoaWxkKCduZ1BhbGV0dGUnLCB7IHN0YXRpYzogdHJ1ZSB9KSBwdWJsaWMgcGFsZXR0ZURpdjogRWxlbWVudFJlZjtcclxuXHJcbiAgLy8gVGhlIFBhbGV0dGUgaXRzZWxmXHJcbiAgcHVibGljIHBhbGV0dGU6IGdvLlBhbGV0dGUgfCBudWxsID0gbnVsbDtcclxuXHJcbiAgLy8gRGlmZmVycyBmb3IgYXJyYXkgSW5wdXRzIChsaW5rIC8gbm9kZSBkYXRhIGFycmF5cylcclxuICBwdWJsaWMgX25kYURpZmZlcjogYW55O1xyXG4gIHB1YmxpYyBfbGRhRGlmZmVyOiBhbnk7XHJcblxyXG4gIC8vIGRpZmZlciBmb3IgbW9kZWxEYXRhIG9iamVjdFxyXG4gIHByaXZhdGUgX21kRGlmZmVyOiBLZXlWYWx1ZURpZmZlcjxzdHJpbmcsIGFueT47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgX2RpZmZlcnM6IEl0ZXJhYmxlRGlmZmVycywgcHJpdmF0ZSBfa3ZkaWZmZXJzOiBLZXlWYWx1ZURpZmZlcnMsIHB1YmxpYyB6b25lOiBOZ1pvbmUpIHtcclxuICAgIC8vIGRpZmZlcnMgdXNlZCB0byBjaGVjayBpZiB0aGVyZSBoYXZlIGJlZW4gY2hhbmdlZCB0byB0aGUgYXJyYXkgQElucHV0c1xyXG4gICAgLy8gd2l0aG91dCB0aGVtLCBjaGFuZ2VzIHRvIHRoZSBpbnB1dCBhcnJheXMgd29uJ3QgcmVnaXN0ZXIgaW4gbmdPbkNoYW5nZXMsXHJcbiAgICAvLyBzaW5jZSB0aGUgYXJyYXkgcmVmZXJlbmNlIGl0c2VsZiBtYXkgYmUgdGhlIHNhbWVcclxuICAgIHRoaXMuX25kYURpZmZlciA9IHRoaXMuX2RpZmZlcnMuZmluZChbXSkuY3JlYXRlKG51bGwpO1xyXG4gICAgdGhpcy5fbGRhRGlmZmVyID0gdGhpcy5fZGlmZmVycy5maW5kKFtdKS5jcmVhdGUobnVsbCk7XHJcblxyXG4gICAgLy8gYWxzbyB3YXRjaCBpZiBtb2RlbCBkYXRhIGNoYW5nZXM7IHRoaXMgZGlmZmVyIG11c3QgYmUgaW5pdGlhbGl6ZWQgaW4gbmdPbkluaXRcclxuICB9IC8vIGVuZCBjb25zdHJ1Y3RvclxyXG5cclxuICBwdWJsaWMgbmdPbkluaXQoKSB7XHJcbiAgICAvLyBpbml0aWFsaXplIHRoZSBkaWZmZXIgdGhhdCBsaXN0ZW5zIGZvciBjaGFuZ2VzIHRvIG1vZGVsRGF0YSBvYmplY3RcclxuICAgIGlmICh0aGlzLm1vZGVsRGF0YSkge1xyXG4gICAgICB0aGlzLl9tZERpZmZlciA9IHRoaXMuX2t2ZGlmZmVycy5maW5kKHRoaXMubW9kZWxEYXRhKS5jcmVhdGUoKTtcclxuICAgIH1cclxuICB9IC8vIGVuZCBuZ09uSW5pdFxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIFBhbGV0dGUgYWZ0ZXIgdmlldyBpbml0XHJcbiAgICovXHJcbiAgcHVibGljIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcclxuICAgIGlmICghdGhpcy5wYWxldHRlRGl2KSByZXR1cm47XHJcblxyXG4gICAgdGhpcy5wYWxldHRlID0gdGhpcy5pbml0UGFsZXR0ZSgpO1xyXG5cclxuICAgIC8vIFRoaXMgYml0IG9mIGNvZGUgbWFrZXMgc3VyZSB0aGUgbW91c2Vtb3ZlIGV2ZW50IGxpc3RlbmVycyBvbiB0aGUgY2FudmFzIGFyZSBydW4gb3V0c2lkZSBOZ1pvbmVcclxuICAgIC8vIFRoaXMgbWFrZXMgaXQgc28gY2hhbmdlIGRldGVjdGlvbiBpc24ndCB0cmlnZ2VyZWQgZXZlcnkgdGltZSB0aGUgbW91c2UgaXMgbW92ZWQgaW5zaWRlIHRoZSBjYW52YXMsIGdyZWF0bHkgaW1wcm92aW5nIHBlcmZvcm1hbmNlXHJcbiAgICAvLyBJZiBzb21lIHN0YXRlLWFsdGVyaW5nIGJlaGF2aW9yIG11c3QgaGFwcGVuIG9uIGEgbW91c2Vtb3ZlIGV2ZW50IGluc2lkZSB0aGUgcGFsZXR0ZSxcclxuICAgIC8vIHlvdSB3aWxsIGhhdmUgdG8gdXNpbmcgem9uZS5ydW4oKSB0byBtYWtlIHN1cmUgdGhhdCBldmVudCB0cmlnZ2VycyBhbmd1bGFyIGNoYW5nZSBkZXRlY3Rpb25cclxuICAgIHRoaXMucGFsZXR0ZS5hZGRFdmVudExpc3RlbmVyID0gKERPTUVsZW1lbnQ6IEVsZW1lbnQgfCBXaW5kb3cgfCBEb2N1bWVudCwgbmFtZTogc3RyaW5nLCBsaXN0ZW5lcjogYW55LCBjYXB0dXJlOiBib29sZWFuKSA9PiB7XHJcbiAgICAgIGNvbnN0IHN1cGVyQWRkRXZlbnRMaXN0ZW5lciA9IGdvLkRpYWdyYW0ucHJvdG90eXBlLmFkZEV2ZW50TGlzdGVuZXI7XHJcbiAgICAgIGlmIChuYW1lID09PSAnbW91c2Vtb3ZlJykge1xyXG4gICAgICAgIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiBzdXBlckFkZEV2ZW50TGlzdGVuZXIuY2FsbCh0aGlzLCBET01FbGVtZW50LCBuYW1lLCBsaXN0ZW5lciwgY2FwdHVyZSkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuem9uZS5ydW4oKCkgPT4ge1xyXG4gICAgICAgICAgc3VwZXJBZGRFdmVudExpc3RlbmVyLmNhbGwodGhpcywgRE9NRWxlbWVudCwgbmFtZSwgbGlzdGVuZXIsIGNhcHR1cmUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIGFzc2lnbiB0aGUgUGFsZXR0ZSdzIGRpdiwgd2hpY2ggKGFtb25nIG1hbnkgb3RoZXIgdGhpbmdzKSB3aWxsIGF0dGFjaCBhIGJ1bmNoIG9mIGxpc3RlbmVycyB0byB0aGUgY2FudmFzLFxyXG4gICAgLy8gdXNpbmcgdGhlIG92ZXJyaWRkZW4gYWRkRXZlbnRMaXN0ZW5lciBmdW5jdGlvbiBhYm92ZVxyXG4gICAgY29uc3QgZGl2UmVmID0gdGhpcy5wYWxldHRlRGl2Lm5hdGl2ZUVsZW1lbnQ7XHJcbiAgICB0aGlzLnBhbGV0dGUuZGl2ID0gZGl2UmVmO1xyXG5cclxuICAgIC8vIGluaXRpYWxpemUgcGFsZXR0ZSBtb2RlbFxyXG4gICAgdGhpcy5wYWxldHRlLmRlbGF5SW5pdGlhbGl6YXRpb24oKCkgPT4ge1xyXG4gICAgICBjb25zdCBtb2RlbCA9IHRoaXMucGFsZXR0ZS5tb2RlbDtcclxuICAgICAgbW9kZWwuY29tbWl0KChtOiBnby5Nb2RlbCkgPT4ge1xyXG4gICAgICAgIG0ubWVyZ2VOb2RlRGF0YUFycmF5KG0uY2xvbmVEZWVwKHRoaXMubm9kZURhdGFBcnJheSkpO1xyXG4gICAgICAgIGlmICh0aGlzLmxpbmtEYXRhQXJyYXkgJiYgbSBpbnN0YW5jZW9mIGdvLkdyYXBoTGlua3NNb2RlbCkge1xyXG4gICAgICAgICAgbS5tZXJnZUxpbmtEYXRhQXJyYXkobS5jbG9uZURlZXAodGhpcy5saW5rRGF0YUFycmF5KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLm1vZGVsRGF0YSkge1xyXG4gICAgICAgICAgbS5hc3NpZ25BbGxEYXRhUHJvcGVydGllcyhtLm1vZGVsRGF0YSwgdGhpcy5tb2RlbERhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSwgbnVsbCk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgLy8gaW5pdGlhbGl6ZXIgbGlzdGVuZXJcclxuICAgIHRoaXMubW9kZWxDaGFuZ2VkTGlzdGVuZXIgPSAoZTogZ28uQ2hhbmdlZEV2ZW50KSA9PiB7XHJcbiAgICAgIGlmIChlLmlzVHJhbnNhY3Rpb25GaW5pc2hlZCkge1xyXG4gICAgICAgIC8vIHRoaXMgbXVzdCBiZSBkb25lIHdpdGhpbiBhIE5nWm9uZS5ydW4gYmxvY2ssIHNvIGNoYW5nZXMgYXJlIGRldGVjdGVkIGluIHRoZSBwYXJlbnQgY29tcG9uZW50XHJcbiAgICAgICAgdGhpcy56b25lLnJ1bigoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBkYXRhQ2hhbmdlcyA9IGUubW9kZWwhLnRvSW5jcmVtZW50YWxEYXRhKGUpO1xyXG4gICAgICAgICAgdGhpcy5tb2RlbENoYW5nZS5lbWl0KGRhdGFDaGFuZ2VzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuICAgIHRoaXMucGFsZXR0ZS5hZGRNb2RlbENoYW5nZWRMaXN0ZW5lcih0aGlzLm1vZGVsQ2hhbmdlZExpc3RlbmVyKTtcclxuICB9IC8vIGVuZCBuZ0FmdGVyVmlld0luaXRcclxuXHJcbiAgLyoqXHJcbiAgICogQWx3YXlzIGJlIGNoZWNraW5nIGlmIGFycmF5IElucHV0IGRhdGEgaGFzIGNoYW5nZWQgKG5vZGUgYW5kIGxpbmsgZGF0YSBhcnJheXMpXHJcbiAgICovXHJcbiAgcHVibGljIG5nRG9DaGVjaygpIHtcclxuICAgIGNvbnN0IG5vZGVEYXRhQXJyYXlDaGFuZ2VzID0gdGhpcy5fbmRhRGlmZmVyLmRpZmYodGhpcy5ub2RlRGF0YUFycmF5KTtcclxuICAgIGNvbnN0IGxpbmtEYXRhQXJyYXlDaGFuZ2VzID0gdGhpcy5fbGRhRGlmZmVyLmRpZmYodGhpcy5saW5rRGF0YUFycmF5KTtcclxuICAgIGxldCBtb2RlbERhdGFDaGFuZ2VzID0gbnVsbDtcclxuICAgIGlmICh0aGlzLl9tZERpZmZlcikge1xyXG4gICAgICBtb2RlbERhdGFDaGFuZ2VzID0gdGhpcy5fbWREaWZmZXIuZGlmZih0aGlzLm1vZGVsRGF0YSk7XHJcbiAgICB9XHJcbiAgICBpZiAobm9kZURhdGFBcnJheUNoYW5nZXMgfHwgbGlua0RhdGFBcnJheUNoYW5nZXMgfHwgbW9kZWxEYXRhQ2hhbmdlcykge1xyXG4gICAgICB0aGlzLnVwZGF0ZUZyb21BcHBEYXRhKCk7XHJcbiAgICB9XHJcbiAgfSAvLyBlbmQgbmdEb0NoZWNrXHJcblxyXG4gIC8qKlxyXG4gICAqIFNvbWUgaW5wdXQgcHJvcGVydHkgaGFzIGNoYW5nZWQgKG9yIGl0cyBjb250ZW50cyBjaGFuZ2VkKSBpbiBwYXJlbnQgY29tcG9uZW50LlxyXG4gICAqIFVwZGF0ZSBwYWxldHRlIGRhdGEgYWNjb3JkaW5nbHlcclxuICAgKi9cclxuICBwdWJsaWMgdXBkYXRlRnJvbUFwcERhdGEoKSB7XHJcbiAgICBpZiAoIXRoaXMucGFsZXR0ZSkgcmV0dXJuO1xyXG4gICAgY29uc3QgbW9kZWwgPSB0aGlzLnBhbGV0dGUubW9kZWw7XHJcblxyXG4gICAgbW9kZWwuc3RhcnRUcmFuc2FjdGlvbigndXBkYXRlIGRhdGEnKTtcclxuICAgIG1vZGVsLm1lcmdlTm9kZURhdGFBcnJheShtb2RlbC5jbG9uZURlZXAodGhpcy5ub2RlRGF0YUFycmF5KSk7XHJcbiAgICBpZiAodGhpcy5saW5rRGF0YUFycmF5ICYmIG1vZGVsIGluc3RhbmNlb2YgZ28uR3JhcGhMaW5rc01vZGVsKSB7XHJcbiAgICAgIG1vZGVsLm1lcmdlTGlua0RhdGFBcnJheShtb2RlbC5jbG9uZURlZXAodGhpcy5saW5rRGF0YUFycmF5KSk7XHJcbiAgICB9XHJcbiAgICBpZiAodGhpcy5tb2RlbERhdGEpIHtcclxuICAgICAgbW9kZWwuYXNzaWduQWxsRGF0YVByb3BlcnRpZXMobW9kZWwubW9kZWxEYXRhLCB0aGlzLm1vZGVsRGF0YSk7XHJcbiAgICB9XHJcbiAgICBtb2RlbC5jb21taXRUcmFuc2FjdGlvbigndXBkYXRlIGRhdGEnKTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG4iXX0=